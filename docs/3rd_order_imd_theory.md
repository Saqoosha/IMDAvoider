# 3次IMDの理論的背景

## 3次IMDの生成メカニズム

3次IMDは、非線形デバイス（アンプ、ミキサーなど）で3つの周波数成分が混合されて生成されます。

### 数学的表現

非線形デバイスの出力は以下のように表現できます：

```
Vout = a1·Vin + a2·Vin² + a3·Vin³ + ...
```

3次の項（a3·Vin³）から3次IMDが生成されます。

## 2周波数入力の場合（f1, f2）

入力信号：`Vin = A1·cos(2πf1t) + A2·cos(2πf2t)`

3次の項を展開すると、以下の周波数成分が現れます：

### 主要な3次IMD製品：
1. **2f1 - f2** （最も強い）
2. **2f2 - f1** （最も強い）
3. **2f1 + f2** （通常は帯域外）
4. **2f2 + f1** （通常は帯域外）

これが当プロジェクトで実装している4つのパターンです。

## 3周波数入力の場合（f1, f2, f3）

入力信号：`Vin = A1·cos(2πf1t) + A2·cos(2πf2t) + A3·cos(2πf3t)`

3次の項を展開すると、理論的には以下のすべての組み合わせが可能です：

### タイプ1：3つの異なる周波数の積（f1·f2·f3型）
1. **f1 + f2 - f3**
2. **f1 - f2 + f3**
3. **-f1 + f2 + f3**
4. **f1 + f2 + f3** （通常は帯域外）

### タイプ2：1つの周波数が2回使われる積（f1²·f2型）
5. **2f1 - f2**（2周波数の場合と同じ）
6. **2f1 + f2**（通常は帯域外）
7. **2f2 - f1**（2周波数の場合と同じ）
8. **2f2 + f1**（通常は帯域外）

### タイプ3：より複雑な組み合わせ
9. **2f1 - f2 - f3**
10. **2f1 + f2 - f3**
11. **2f1 - f2 + f3**
12. **f1 - 2f2 + f3**
13. **f1 + 2f2 - f3**
14. **-f1 + 2f2 + f3**
... など

## なぜ6パターンや10パターンなのか？

### 6パターン（当プロジェクトの初期実装）
- **2周波数IMD**：3パターン（2f2-f1, f1+2f2, 2f1+f2）
- **3周波数IMD**：3パターン（f1+f2-f3, f1-f2+f3, -f1+f2+f3）
- **理由**：最も一般的で影響が大きいパターンに絞った実用的アプローチ

### 10パターン（IMDAvoider3）
IMDAvoider3が選んだ10パターンは、おそらく以下の基準で選定：
1. 周波数範囲内に収まりやすいパターン
2. 実際の干渉報告で観測されたパターン
3. 計算の対称性を考慮

## 理論的にはもっと多い

実際には、3次の非線形性から生成される周波数成分は数十種類に及びます。しかし：

1. **多くは帯域外**：f1+f2+f3のような和の項は通常15GHz以上になる
2. **信号強度が弱い**：複雑な組み合わせほど信号強度が弱くなる
3. **実用的でない**：すべてを計算してもコストに見合わない

## 結論

- **理論的**：3次IMDは数十種類のパターンが可能
- **実用的**：6-10パターンで十分（帯域内に収まり、強度が高いもの）
- **選択基準**：
  - 周波数範囲内（5100-6099 MHz）に収まる可能性
  - 信号強度（より単純な組み合わせが強い）
  - 実際の干渉報告での観測頻度

当プロジェクトの10パターン実装は、理論と実用のバランスが取れた適切な選択です。